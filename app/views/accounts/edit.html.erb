<% content_for :javascript do %>

  function ajaxCreateUserMapForm() {
    $('#new_user_map').live('submit', function() {
      $('#wait').show();
  		$(this).ajaxSubmit({
        target: '#ajax_block',
        clearForm: true,
  			success: function () {
  			  $('#wait').hide();
					if ($('#error_explanation').length > 0) {
					  $('#newRecordButton').click();
						move_error();
					}
  			}
      });
      return false
    });
  }

  function ajaxUpdateUserMapForm() {
    $('form.edit_user_map').live('submit', function() {
  	  $('#wait').show();
      $(this).ajaxSubmit({
        target: ('#' + $(this).parent().attr('id')),
        success: function () {
          $('#wait').hide();
					if ($('#error_explanation').length > 0) {
            move_error();
          }
        }
  	  });
      return false
    });
  }

  function ajaxDeleteUserMapForm() {
    $('form.button_to').live('submit', function() {
      $('#wait').show();
  		$(this).ajaxSubmit({
        target: '#ajax_block',
  			success: function () {
          $('#wait').hide();
					if ($('#error_explanation').length > 0) {
            move_error();
          }
        }
      });
      return false
    });
  }
  
  $(function() {
    ajaxCreateUserMapForm()
    ajaxUpdateUserMapForm()
  	ajaxDeleteUserMapForm()
  })
	
  // manage master user radio buttons	
  $('input.master_radio').live('click', function() {
    $('input.master_radio').removeAttr('checked');
  	$(this).attr('checked','checked');
  	$(this).parent().submit();		
  });
	
  $('#wait').hide();
	$('#error_container').hide();
	
	$('#newRecordButton').live('click', function() {
    var tb = $('#newRecordTable');
    if (tb.hasClass('hidden')){
      tb.slideDown();
      $('#newRecordButton').hide();
    }
  });

  if ($('#notice').text().length > 0) {
    $('#notice').animate({}, 500).delay(3000).fadeOut('slow');
  }
	
	if ($('#error_explanation').length > 0) {
	  move_error();
	}
	
	function move_error() {
    $('#error_container').show();
    $('#error_container').append($('#error_explanation'));
    $('#error_explanation').attr('id','error_explanation_set');
	}
	
	$('#error_container').ajaxSuccess(function () {
	  if ($('#error_explanation').length > 0) {
      $('#error_explanation').addClass('error_div');
			$('#error_container').show();
      $('#error_container').append($('#error_explanation'));
    }
	});

<%end%>

<div class="plugin">

	<p id="notice"><%= notice %></p>
	<p id="alert"><%= alert %></p>
	<div id="error_container" ></div>
	
	<div id="wait"><%= t('wait_loading') %></div>
	
	<% if @account.hr_subdomain.present? %>
	
	  <h4><%= t('account.tokens_and_users') %></h4>
		<%= render 'user_maps/block_for_ajax' %>
	
	<% else %>
	
	  <h3><%= t('account.save_subdomain') %></h3>
    <br/>

	<% end %>
	
	<%= render 'form' %>

</div>
